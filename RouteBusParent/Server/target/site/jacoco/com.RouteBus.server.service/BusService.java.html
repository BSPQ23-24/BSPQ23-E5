<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BusService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Server</a> &gt; <a href="index.source.html" class="el_package">com.RouteBus.server.service</a> &gt; <span class="el_source">BusService.java</span></div><h1>BusService.java</h1><pre class="source lang-java linenums">package com.RouteBus.server.service;

import java.util.List;
import java.util.Optional;

import javax.transaction.Transactional;

import org.springframework.stereotype.Service;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

import com.RouteBus.server.dao.BusRepository;
import com.RouteBus.server.dao.RouteRepository;
import com.RouteBus.server.dao.StationRepository;
import com.RouteBus.server.dao.TicketRepository;
import com.RouteBus.server.dao.UserRepository;
import com.RouteBus.server.model.Bus;
import com.RouteBus.server.model.Route;
import com.RouteBus.server.model.Station;
import com.RouteBus.server.model.Ticket;
import com.RouteBus.server.model.User;
import com.RouteBus.server.service.UserService.UserServiceResult;

@Service
public class BusService {
	private BusRepository busRepository;
	private RouteRepository routeRepository;
	private StationRepository stationRepository;
	private TicketRepository ticketRepository;
	
<span class="fc" id="L31">	public BusService(BusRepository busRepository,RouteRepository routeRepository, StationRepository stationRepository, TicketRepository ticketRepository) {</span>
<span class="fc" id="L32">        this.busRepository = busRepository;</span>
<span class="fc" id="L33">        this.routeRepository=routeRepository;</span>
<span class="fc" id="L34">        this.stationRepository=stationRepository;</span>
<span class="fc" id="L35">        this.ticketRepository=ticketRepository;</span>
<span class="fc" id="L36">    }</span>
<span class="nc" id="L37">    public enum BusServiceResult {</span>
<span class="nc" id="L38">		SUCCESS,</span>
<span class="nc" id="L39">		FAIL;</span>
	}

    /**  Returning User information */
    public Bus getBusById(Long id) {
<span class="nc" id="L44">    	Optional&lt;Bus&gt; result = busRepository.findById(id);</span>
<span class="nc" id="L45">    	return result.orElse(null);</span>
    }

    
    public List&lt;Bus&gt; getAllBuses() {
<span class="nc" id="L50">        return busRepository.findAll();</span>
    }

    /** Creating a New User */
	public BusServiceResult createBus(Bus bus) {
<span class="nc" id="L55">		Optional&lt;Bus&gt; result = busRepository.findById(bus.getId());</span>
		
<span class="nc bnc" id="L57" title="All 2 branches missed.">		if (result.isEmpty()) {</span>
<span class="nc" id="L58">			Bus savedBus = busRepository.save(bus);</span>
			
<span class="nc bnc" id="L60" title="All 2 branches missed.">			if (savedBus != null) {</span>
<span class="nc" id="L61">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L65">		return BusServiceResult.FAIL;</span>
	}    
   
    /** Update an Existing User */
    public BusServiceResult updateBus(Bus bus, String licensePlate) {
<span class="nc" id="L70">    	Optional&lt;Bus&gt; result = busRepository.findByLicensePlate(licensePlate);</span>
		
<span class="nc bnc" id="L72" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L73">			Bus updatedBus = result.get();</span>
			
<span class="nc" id="L75">			updatedBus.setCapacity(bus.getCapacity());</span>

<span class="nc" id="L77">			busRepository.save(updatedBus);</span>
			
<span class="nc bnc" id="L79" title="All 2 branches missed.">			if (!busRepository.findByLicensePlate(licensePlate).isEmpty()) {</span>
<span class="nc" id="L80">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L84">		return BusServiceResult.FAIL;</span>
    }
  
    /** Delete one User*/
    public BusServiceResult deleteBus(Long id) {
<span class="nc" id="L89">    	Optional&lt;Bus&gt; result = busRepository.findById(id);</span>
		
<span class="nc bnc" id="L91" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L92">			busRepository.delete(result.get());</span>

<span class="nc bnc" id="L94" title="All 2 branches missed.">			if (busRepository.findById(id).isEmpty()) {</span>
<span class="nc" id="L95">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L99">		return BusServiceResult.FAIL;</span>
    }
    
    /** Delete all Users in the database  */
    public BusServiceResult deleteAllBuses() {
<span class="nc" id="L104">    	BusServiceResult result = BusServiceResult.SUCCESS;</span>
		
<span class="nc bnc" id="L106" title="All 2 branches missed.">		for (Bus b : busRepository.findAll()) {</span>
<span class="nc" id="L107">			busRepository.deleteById(b.getId());</span>

<span class="nc bnc" id="L109" title="All 2 branches missed.">			if (!busRepository.findById(b.getId()).isEmpty()) {</span>
<span class="nc" id="L110">				result = BusServiceResult.FAIL;</span>
			}
<span class="nc" id="L112">		}</span>
<span class="nc" id="L113">		return result;</span>
    }
    
    public Route getRouteById(Long id) {
<span class="nc" id="L117">    	Optional&lt;Route&gt; result = routeRepository.findById(id);</span>
<span class="nc" id="L118">    	return result.orElse(null);</span>
    }
    public List&lt;Route&gt; getAllRoutes() {
<span class="nc" id="L121">        return routeRepository.findAll();</span>
    }

    @Transactional
	public BusServiceResult createRoute(Route route) {
<span class="nc" id="L126">		Optional&lt;Route&gt; result = routeRepository.findById(route.getId());</span>
		
<span class="nc bnc" id="L128" title="All 2 branches missed.">		if (result.isEmpty()) {</span>
<span class="nc" id="L129">			Route savedroute = routeRepository.save(route);</span>
			
<span class="nc bnc" id="L131" title="All 2 branches missed.">			if (savedroute != null) {</span>
<span class="nc" id="L132">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L136">		return BusServiceResult.FAIL;</span>
	}    
   
    /** Update an Existing User */
    public BusServiceResult updateRoute(Route route, String name) {
<span class="nc" id="L141">    	Optional&lt;Route&gt; result = routeRepository.findByName(name);</span>
		
<span class="nc bnc" id="L143" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L144">			Route updatedRoute = result.get();</span>
			
<span class="nc" id="L146">			updatedRoute.setBuses(route.getBuses());</span>
<span class="nc" id="L147">			updatedRoute.setStations(route.getStations());</span>
<span class="nc" id="L148">			updatedRoute.setTotalDistance(route.getTotalDistance());</span>

<span class="nc" id="L150">			routeRepository.save(updatedRoute);</span>
			
<span class="nc bnc" id="L152" title="All 2 branches missed.">			if (!routeRepository.findByName(name).isEmpty()) {</span>
<span class="nc" id="L153">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L157">		return BusServiceResult.FAIL;</span>
    }
  
    /** Delete one User*/
    public BusServiceResult deleteRoute(Long id) {
<span class="nc" id="L162">    	Optional&lt;Route&gt; result = routeRepository.findById(id);</span>
		
<span class="nc bnc" id="L164" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L165">			routeRepository.delete(result.get());</span>

<span class="nc bnc" id="L167" title="All 2 branches missed.">			if (routeRepository.findById(id).isEmpty()) {</span>
<span class="nc" id="L168">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L172">		return BusServiceResult.FAIL;</span>
    }
    
    /** Delete all Users in the database  */
    public BusServiceResult deleteAllRoutes() {
<span class="nc" id="L177">    	BusServiceResult result = BusServiceResult.SUCCESS;</span>
		
<span class="nc bnc" id="L179" title="All 2 branches missed.">		for (Route b : routeRepository.findAll()) {</span>
<span class="nc" id="L180">			routeRepository.deleteById(b.getId());</span>

<span class="nc bnc" id="L182" title="All 2 branches missed.">			if (!routeRepository.findById(b.getId()).isEmpty()) {</span>
<span class="nc" id="L183">				result = BusServiceResult.FAIL;</span>
			}
<span class="nc" id="L185">		}</span>
<span class="nc" id="L186">		return result;</span>
    }
    
    public Station getStationById(Long id) {
<span class="nc" id="L190">    	Optional&lt;Station&gt; result = stationRepository.findById(id);</span>
<span class="nc" id="L191">    	return result.orElse(null);</span>
    }
    public List&lt;Station&gt; getAllStations() {
<span class="nc" id="L194">        return stationRepository.findAll();</span>
    }

    /** Creating a New User */
	public BusServiceResult createStation(Station Station) {
<span class="nc" id="L199">		Optional&lt;Station&gt; result = stationRepository.findById(Station.getId());</span>
		
<span class="nc bnc" id="L201" title="All 2 branches missed.">		if (result.isEmpty()) {</span>
<span class="nc" id="L202">			Station savedStation = stationRepository.save(Station);</span>
			
<span class="nc bnc" id="L204" title="All 2 branches missed.">			if (savedStation != null) {</span>
<span class="nc" id="L205">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L209">		return BusServiceResult.FAIL;</span>
	}    
   
    /** Update an Existing User */
    public BusServiceResult updateStation(Station station, String name) {
<span class="nc" id="L214">    	Optional&lt;Station&gt; result = stationRepository.findByName(name);</span>
		
<span class="nc bnc" id="L216" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L217">			Station updatedStation = result.get();</span>
			
<span class="nc" id="L219">			updatedStation.setLocation(station.getLocation());</span>
<span class="nc" id="L220">			updatedStation.setName(station.getName());</span>

<span class="nc" id="L222">			stationRepository.save(updatedStation);</span>
			
<span class="nc bnc" id="L224" title="All 2 branches missed.">			if (!stationRepository.findByName(name).isEmpty()) {</span>
<span class="nc" id="L225">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L229">		return BusServiceResult.FAIL;</span>
    }
  
    /** Delete one User*/
    public BusServiceResult deleteStation(Long id) {
<span class="nc" id="L234">    	Optional&lt;Station&gt; result = stationRepository.findById(id);</span>
		
<span class="nc bnc" id="L236" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L237">			stationRepository.delete(result.get());</span>

<span class="nc bnc" id="L239" title="All 2 branches missed.">			if (stationRepository.findById(id).isEmpty()) {</span>
<span class="nc" id="L240">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L244">		return  BusServiceResult.FAIL;</span>
    }
    
    /** Delete all Users in the database  */
    public BusServiceResult deleteAllStations() {
<span class="nc" id="L249">    	BusServiceResult result = BusServiceResult.SUCCESS;</span>
		
<span class="nc bnc" id="L251" title="All 2 branches missed.">		for (Station b : stationRepository.findAll()) {</span>
<span class="nc" id="L252">			stationRepository.deleteById(b.getId());</span>

<span class="nc bnc" id="L254" title="All 2 branches missed.">			if (!stationRepository.findById(b.getId()).isEmpty()) {</span>
<span class="nc" id="L255">				result = BusServiceResult.FAIL;</span>
			}
<span class="nc" id="L257">		}</span>
<span class="nc" id="L258">		return result;</span>
    }

    public Ticket getTicketById(long id) {
<span class="nc" id="L262">    	Optional&lt;Ticket&gt; result = ticketRepository.findById(id);</span>
<span class="nc" id="L263">    	return result.orElse(null);</span>
    }
    public List&lt;Ticket&gt; getAllTickets() {
<span class="nc" id="L266">        return ticketRepository.findAll();</span>
    }

    /** Creating a New User */
	public BusServiceResult createTicket(Ticket Ticket) {
<span class="nc" id="L271">		Optional&lt;Ticket&gt; result = ticketRepository.findById(Ticket.getId());</span>
		
<span class="nc bnc" id="L273" title="All 2 branches missed.">		if (result.isEmpty()) {</span>
<span class="nc" id="L274">			Ticket savedTicket = ticketRepository.save(Ticket);</span>
			
<span class="nc bnc" id="L276" title="All 2 branches missed.">			if (savedTicket != null) {</span>
<span class="nc" id="L277">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L281">		return BusServiceResult.FAIL;</span>
	}    
   
    /** Update an Existing User */
    public BusServiceResult updateTicket(Ticket ticket, Long id) {
<span class="nc" id="L286">    	Optional&lt;Ticket&gt; result = ticketRepository.findById(id);</span>
		
<span class="nc bnc" id="L288" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L289">			Ticket updatedTicket = result.get();</span>
<span class="nc" id="L290">			updatedTicket.setPrice(ticket.getPrice());</span>
<span class="nc" id="L291">			ticketRepository.save(updatedTicket);</span>
<span class="nc bnc" id="L292" title="All 2 branches missed.">			if (!ticketRepository.findById(id).isEmpty()) {</span>
<span class="nc" id="L293">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L297">		return BusServiceResult.FAIL;</span>
    }
  
    /** Delete one User*/
    public BusServiceResult deleteTicket(Long id) {
<span class="nc" id="L302">    	Optional&lt;Ticket&gt; result = ticketRepository.findById(id);</span>
		
<span class="nc bnc" id="L304" title="All 2 branches missed.">		if (!result.isEmpty()) {</span>
<span class="nc" id="L305">			ticketRepository.delete(result.get());</span>

<span class="nc bnc" id="L307" title="All 2 branches missed.">			if (ticketRepository.findById(id).isEmpty()) {</span>
<span class="nc" id="L308">				return BusServiceResult.SUCCESS;</span>
			}
		}
		
<span class="nc" id="L312">		return BusServiceResult.FAIL;</span>
    }
    
    
    public BusServiceResult deleteAllTickets() {
<span class="nc" id="L317">    	BusServiceResult result = BusServiceResult.SUCCESS;</span>
		
<span class="nc bnc" id="L319" title="All 2 branches missed.">		for (Ticket b : ticketRepository.findAll()) {</span>
<span class="nc" id="L320">			ticketRepository.deleteById(b.getId());</span>
<span class="nc bnc" id="L321" title="All 2 branches missed.">			if (!ticketRepository.findById(b.getId()).isEmpty()) {</span>
<span class="nc" id="L322">				result = BusServiceResult.FAIL;</span>
			}
<span class="nc" id="L324">		}</span>
<span class="nc" id="L325">		return result;</span>
    }
    @Transactional
    public BusServiceResult addStationToRoute(Route route, Station station) {
<span class="nc bnc" id="L329" title="All 4 branches missed.">    	if (route.addStation(station)&amp;&amp;station.addRoute(route)) {</span>
<span class="nc bnc" id="L330" title="All 4 branches missed.">    		 if(this.updateRoute(route, route.getName()).equals(BusServiceResult.SUCCESS)&amp;&amp;this.updateStation(station, station.getName()).equals(BusServiceResult.SUCCESS)) {</span>
<span class="nc" id="L331">    			 return BusServiceResult.SUCCESS;</span>
    		 }
    	}
<span class="nc" id="L334">    	return BusServiceResult.FAIL;</span>
    }
    @Transactional
    public BusServiceResult addBusToRoute(Route route, Bus bus) {
<span class="nc bnc" id="L338" title="All 4 branches missed.">    	if (route.addBus(bus)&amp;&amp;bus.addRoute(route)) {</span>
<span class="nc bnc" id="L339" title="All 4 branches missed.">    		 if(this.updateRoute(route, route.getName()).equals(BusServiceResult.SUCCESS)&amp;&amp;this.updateBus(bus, bus.getLicensePlate()).equals(BusServiceResult.SUCCESS)) {</span>
<span class="nc" id="L340">    			 return BusServiceResult.SUCCESS;</span>
    		 }
    	}
<span class="nc" id="L343">    	return BusServiceResult.FAIL;</span>
    }

    
    public List&lt;Route&gt; obtainRoutesByBus(Long busId) {
<span class="nc" id="L348">            return routeRepository.findByBusesId(busId);</span>
        }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.12.202403310830</span></div></body></html>